<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-theme/ll-theme.html">

<!--
Example:

    <ll-list-control></ll-list-control>

@demo
-->
<dom-module id="ll-list-control">

  <style>
    h2 {
      border: none;
      padding-bottom: 0;
    }

    .btn-default {
      padding: .7em 1.8em;
      font-size: 1.4rem;
    }
  </style>

  <template>
    <div style="display: block;">
      <div class="row">
        <div class="col-sm-4">
          <h2>[[controlTitle]]</h2>
        </div>
        <div class="col-sm-8">
          <div class="pull-right">
            <div id="addItemButton" class="btn btn-primary pull-right" on-tap="_fireAssociateItemsSelected">[[associateText]]</div>
            <div id="addNewButton" class="btn btn-default pull-right" on-tap="_fireCreateNewSelected" style="margin-right:15px;">Create New</div>
            <div id="removeItemButton" class="btn btn-destructive pull-right" on-tap="_fireRemoveSelected" style="margin-right:15px;display:none;">Remove Selected</div>
          </div>
        </div>
      </div>
      <hr>
      <template id="item-list" is="dom-repeat" items="[[items]]" >
        <div>
          <div style="margin-bottom:10px;" class="row">
            <div class="col-sm-1 col-xs-2 text-center">
              <input type="radio" name=[[radioButtonGroupName]] id="[[_itemIdentifier(item)]]" on-tap="_prepareForRemoval">
            </div>
            <div class="col-sm-3 col-xs-10">[[_itemDisplay(item)]]</div>
          </div>
        </div>
      </template>
      <p id="listEmpty" style="display: block;">[[emptyListText]] <a href="#" id="addItemLink">Add one now &gt;</a></p>
      <hr>
    </div>
  </template>

</dom-module>

<script>
  var selectedItemId = '';

  Polymer({

    is: 'll-list-control',

    properties: {
      /**
       * The Title of the control
       */
      controlTitle: {
        type: String,
        default: ''
      },
      /**
       * The text to display on the associate existing button
       */
      associateText: {
        type: String,
        default: 'Associate New'
      },
      /**
       * The text to display when no items are available
       */
      emptyListText: {
        type: String,
        default: 'Nothing to display'
      },
      /**
       * The items to display
       *
       * This array is generic:
       *    populate the idFieldName property to identify the field name that contains the id
       *    populate the displayFieldNames array to identify the fields to be displayed in the list
       *
       */
      items: {
        type: Array,
        notify: true,
        default: [],
        observer: '_showEmptyText'
      },
      /**
       * The name of the id field in the items array
       *
       */
      idFieldName: {
        type: String,
        default: 'id'
      },
      /**
       * An array of field names to display in the list
       *
       * usage: display-field-names=JSON.stringify(["name","description"])
       */
      displayFieldNames: {
        type: Array,
        default: ['name']
      },
      /**
       * Separator used when building the list
       *
       */
      displayFieldSeparator: {
        type: String,
        default: ' '
      },
      /**
       * This allows multiple radio button groups on the same html page
       * simple change the name for this control to have its own radio button group
       *
       */
      radioButtonGroupName: {
        type: String,
        default: 'toRemove'
      }
    },

    /**
     * Internal funtction to set the identifier for the radio button
     */
    _itemIdentifier: function(item){
      return item[this.idFieldName];
    },
    /**
     * Internal funtction to set the display text of each line item
     */
    _itemDisplay: function(item){
      var result = '';
      this.displayFieldNames = this.displayFieldNames || [];
      this.displayFieldSeparator = this.displayFieldSeparator || ' ';

      for (var i = 0; i < this.displayFieldNames.length; i++) {
        result += item[this.displayFieldNames[i]] + this.displayFieldSeparator;
      }
      if (result.length > this.displayFieldSeparator.length){
        result = result.substring(0, result.length - this.displayFieldSeparator.length);
      }
      return result;
    },
    /**
     * Internal function to hide or show the "empty text"
     */
    _showEmptyText: function(){
      this.toggleClass('hidden', this.items.length, this.$.listEmpty);
    },
    /**
     * Internal function to set the internal selectedItemId so that when a user selects the "Remove" button an event
     * can fire with the selected id
     */
    _prepareForRemoval: function(e){
      this.selectedItemId = e.target.id;
      this.$.removeItemButton.style.display = "block";
    },
    /**
     * Event - Remove Selected
     *
     * Params: {selectedItemId: "stringIdentifier"}
     */
    _fireRemoveSelected: function(){
      this.fire('remove-selected', {selectedItemId: this.selectedItemId});
    },
    /**
     * Event - create-new
     */
    _fireCreateNewSelected: function(){
      this.fire('create-new');
    },
    /**
     * Event - associate-new
     */
    _fireAssociateItemsSelected: function(){
      this.fire('associate-items');
    }

  });

</script>
